<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«Ø± | Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©</title>
    <link rel="icon" type="image/x-icon" href="ØªÙ†Ø²ÙŠÙ„.jpg">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="protection.js"></script>
    <script src="js/modules/auth_guard.js"></script>
    <script src="js/modules/api_proxy.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }
    </script>
    <style>
        :root {
            --org-primary: #0f172a;
            --org-accent: #6366f1;
            --org-success: #10b981;
            --org-warning: #f59e0b;
            --org-danger: #ef4444;
        }

        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }

        .org-nav {
            background: var(--org-primary);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .org-nav .brand {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            text-decoration: none;
        }

        .org-nav .brand img {
            width: 45px;
            border-radius: 10px;
        }

        .org-nav .brand-text {
            font-size: 1.5rem;
            font-weight: 900;
        }

        .org-nav .badge {
            background: var(--org-accent);
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 0.7rem;
            margin-right: 10px;
        }

        .org-nav-links {
            display: flex;
            gap: 15px;
        }

        .org-nav-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 8px;
            transition: 0.3s;
        }

        .org-nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .page-hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(180deg, var(--org-primary) 0%, #1e293b 100%);
            color: white;
        }

        .page-hero h1 {
            font-size: 2.8rem;
            font-weight: 900;
            margin-bottom: 15px;
        }

        .page-hero p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        .main-content {
            max-width: 1400px;
            margin: -50px auto 50px;
            padding: 0 20px;
            position: relative;
        }

        /* Organization Setup Card */
        .org-setup-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.05);
            margin-bottom: 40px;
            animation: slideUp 0.8s ease-out;
        }

        .org-setup-card h2 {
            color: var(--org-primary);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 900;
        }

        .setup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 800;
            margin-bottom: 10px;
            color: #475569;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #f1f5f9;
            background: #f8fafc;
            border-radius: 15px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--org-accent);
            background: white;
            outline: none;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        /* File Upload Zone */
        .file-upload-zone {
            border: 2px dashed #cbd5e1;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: #f8fafc;
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 20px;
        }

        .file-upload-zone:hover {
            border-color: var(--org-accent);
            background: #f1f5f9;
        }

        .file-upload-zone.dragover {
            border-color: var(--org-accent);
            background: rgba(99, 102, 241, 0.05);
        }

        .file-upload-zone i {
            font-size: 3rem;
            color: #94a3b8;
            margin-bottom: 15px;
        }

        .file-upload-zone p {
            color: #64748b;
            margin-bottom: 10px;
        }

        .file-upload-zone .supported {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .uploaded-files {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .uploaded-file {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #e0e7ff;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .uploaded-file .remove-file {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 1.1rem;
        }

        /* Services Grid */
        .services-section {
            margin-top: 40px;
        }

        .services-section h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 40px;
            color: var(--org-primary);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
        }

        .service-box {
            background: white;
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.03);
            border: 2px solid #f1f5f9;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .service-box::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--org-accent);
            transform: scaleX(0);
            transition: 0.4s;
            transform-origin: right;
        }

        .service-box:hover::after {
            transform: scaleX(1);
        }

        .service-box:hover {
            border-color: var(--org-accent);
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.1);
        }

        .service-box.active {
            border-color: var(--org-accent);
            background: linear-gradient(135deg, #f5f3ff 0%, #ffffff 100%);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.15);
        }

        .service-box .icon {
            font-size: 3rem;
            margin-bottom: 5px;
            transition: 0.5s;
        }

        .service-box:hover .icon {
            transform: scale(1.2) rotate(5deg);
        }

        .service-box h3 {
            color: var(--org-primary);
            font-size: 1.4rem;
            font-weight: 800;
            margin: 0;
        }

        .service-box p {
            color: #64748b;
            line-height: 1.7;
            font-size: 0.95rem;
            margin: 0;
        }

        .service-box .tag {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #eef2ff;
            color: #4f46e5;
            padding: 4px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
        }

        /* Action Button */
        .action-section {
            text-align: center;
            margin-top: 50px;
        }

        .btn-analyze {
            background: linear-gradient(135deg, var(--org-accent) 0%, #4f46e5 100%);
            color: white;
            border: none;
            padding: 20px 60px;
            border-radius: 50px;
            font-size: 1.3rem;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .btn-analyze:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.4);
        }

        .btn-analyze:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Results Section */
        .results-section {
            display: none;
            margin-top: 50px;
        }

        .result-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .result-card h3 {
            color: var(--org-primary);
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .result-content {
            line-height: 1.8;
            color: #334155;
        }

        .result-content ul {
            padding-right: 25px;
        }

        .result-content li {
            margin-bottom: 10px;
        }

        .result-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .result-content table th,
        .result-content table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: right;
        }

        .result-content table th {
            background: #f1f5f9;
            font-weight: 700;
        }

        /* Export Actions */
        .export-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        .btn-export {
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-export.primary {
            background: var(--org-accent);
            color: white;
            border: none;
        }

        .btn-export.secondary {
            background: white;
            color: var(--org-primary);
            border: 2px solid #e2e8f0;
        }

        .btn-export:hover {
            transform: translateY(-2px);
        }

        /* Loading State */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 6px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--org-accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            margin-top: 30px;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .loading-subtext {
            color: rgba(255, 255, 255, 0.7);
            margin-top: 10px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-hero h1 {
                font-size: 2rem;
            }

            .org-nav {
                flex-direction: column;
                gap: 15px;
            }

            .services-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <!-- Access Check Script -->
    <script>
        (function () {
            const userRaw = localStorage.getItem('athar_user');
            let hasOrgAccess = false;

            if (userRaw) {
                try {
                    const user = JSON.parse(userRaw);
                    hasOrgAccess = user.isOrganization === true || user.isOrganization === "true" ||
                        user.orgAccess === true || user.orgAccess === "true" ||
                        user.isAdmin === true || user.isAdmin === "true" ||
                        user.userType === "institution" || user.userType === "organization";
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }

            if (!hasOrgAccess) {
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø©
                sessionStorage.setItem('show_org_access_modal', 'true');
                window.location.href = 'index.html';
            }
        })();
    </script>
    <!-- Navigation -->
    <nav class="org-nav">
        <a href="index.html" class="brand">
            <img src="ØªÙ†Ø²ÙŠÙ„.jpg" alt="Ø£Ø«Ø±">
            <span class="brand-text">Ø£Ø«Ù€Ù€Ù€Ù€Ù€Ø± <span class="badge">Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª</span></span>
        </a>
        <div class="org-nav-links">
            <a href="index.html"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="ops_dashboard.html"><i class="fas fa-th-large"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
            <a href="library_v3.html"><i class="fas fa-book"></i> Ø§Ù„Ù…ÙƒØªØ¨Ø©</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="page-hero">
        <h1>ğŸ¢ Ù…Ø±ÙƒØ² Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„</h1>
        <p>Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ù…Ø¤Ø³Ø³ÙŠØ© Ø°ÙƒÙŠØ© Ù…Ø®ØµØµØ© 100% Ù„Ù…Ù†Ø¸Ù…ØªÙƒ - ØªØ·ÙˆÙŠØ± Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ØŒ Ø§Ù„Ø³ÙŠØ§Ø³Ø§ØªØŒ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ØŒ ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</p>
    </section>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Organization Setup -->
        <div class="org-setup-card">
            <h2><i class="fas fa-building"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</h2>
            <div class="setup-grid">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</label>
                    <input type="text" id="orgName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø©">
                </div>
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</label>
                    <select id="orgType">
                        <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© --</option>
                        <option value="humanitarian">Ø¥Ù†Ø³Ø§Ù†ÙŠØ© (Humanitarian)</option>
                        <option value="development">ØªÙ†Ù…ÙˆÙŠØ© (Development)</option>
                        <option value="rights">Ø­Ù‚ÙˆÙ‚ÙŠØ© (Human Rights)</option>
                        <option value="education">ØªØ¹Ù„ÙŠÙ…ÙŠØ© (Education)</option>
                        <option value="health">ØµØ­ÙŠØ© (Health)</option>
                        <option value="local">Ù…Ø­Ù„ÙŠØ© (Local NGO)</option>
                        <option value="international">Ø¯ÙˆÙ„ÙŠØ© (INGO)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</label>
                    <select id="orgSize">
                        <option value="">-- Ø§Ø®ØªØ± Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø© --</option>
                        <option value="startup">Ù†Ø§Ø´Ø¦Ø© (Ø£Ù‚Ù„ Ù…Ù† 10 Ù…ÙˆØ¸ÙÙŠÙ†)</option>
                        <option value="small">ØµØºÙŠØ±Ø© (10-50 Ù…ÙˆØ¸Ù)</option>
                        <option value="medium">Ù…ØªÙˆØ³Ø·Ø© (50-200 Ù…ÙˆØ¸Ù)</option>
                        <option value="large">ÙƒØ¨ÙŠØ±Ø© (Ø£ÙƒØ«Ø± Ù…Ù† 200 Ù…ÙˆØ¸Ù)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¯ÙˆÙ„Ø© / Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ</label>
                    <input type="text" id="orgCountry" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ÙŠÙ…Ù†ØŒ Ø³ÙˆØ±ÙŠØ§ØŒ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©</label>
                    <select id="orgPhase">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© --</option>
                        <option value="founding">Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ£Ø³ÙŠØ³</option>
                        <option value="growth">Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙˆØ³Ø¹ ÙˆØ§Ù„Ù†Ù…Ùˆ</option>
                        <option value="restructure">Ø¥Ø¹Ø§Ø¯Ø© Ù‡ÙŠÙƒÙ„Ø©</option>
                        <option value="mature">Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ø¶Ø¬ ÙˆØ§Ù„Ø§Ø³ØªØ¯Ø§Ù…Ø©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª / Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                    <input type="text" id="orgSectors" placeholder="Ù…Ø«Ø§Ù„: WASH, Protection, FSL, Education">
                </div>
            </div>

            <div class="form-group" style="margin-top: 20px;">
                <label>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„ØªÙŠ ØªÙˆØ§Ø¬Ù‡Ù‡Ø§ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©</label>
                <textarea id="orgChallenges" rows="4"
                    placeholder="ØµÙ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: Ø¶Ø¹Ù Ø§Ù„Ù‡ÙŠÙƒÙ„Ø©ØŒ ØºÙŠØ§Ø¨ Ø§Ù„Ø³ÙŠØ§Ø³Ø§ØªØŒ ØµØ¹ÙˆØ¨Ø§Øª Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŒ Ù…Ø´Ø§ÙƒÙ„ MEAL..."></textarea>
            </div>

            <!-- File Upload Zone -->
            <div class="form-group" style="margin-top: 30px;">
                <label><i class="fas fa-cloud-upload-alt"></i> Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <div class="file-upload-zone" id="fileDropZone">
                    <i class="fas fa-file-upload"></i>
                    <p>Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</p>
                    <p class="supported">Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: PDF, DOCX, DOC, TXT (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 10MB Ù„ÙƒÙ„ Ù…Ù„Ù)</p>
                    <input type="file" id="fileInput" multiple accept=".pdf,.docx,.doc,.txt" style="display: none;">
                </div>
                <div class="uploaded-files" id="uploadedFilesList"></div>
            </div>
        </div>

        <!-- Services Selection -->
        <section class="services-section">
            <h2>ğŸ¯ Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h2>
            <div class="services-grid">
                <div class="service-box" data-service="structure" onclick="toggleService(this)">
                    <span class="tag">Ù‡ÙŠÙƒÙ„Ø©</span>
                    <div class="icon">ğŸ—ï¸</div>
                    <h3>ØªØ·ÙˆÙŠØ± Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ</h3>
                    <p>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ø§Ù‚ØªØ±Ø§Ø­ Ù‡ÙŠÙƒÙ„ Ù…Ø®ØµØµØŒ ØªÙˆØµÙŠÙ ÙˆØ¸ÙŠÙÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠØŒ ÙˆØªØ­Ø¯ÙŠØ¯ ÙØ¬ÙˆØ§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ.</p>
                </div>

                <div class="service-box" data-service="policies" onclick="toggleService(this)">
                    <span class="tag">Ø³ÙŠØ§Ø³Ø§Øª</span>
                    <div class="icon">ğŸ“‹</div>
                    <h3>ØªØ·ÙˆÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</h3>
                    <p>Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©ØŒ Ø§Ù„Ø­Ù…Ø§ÙŠØ©ØŒ Ù…Ù†Ø¹ Ø§Ù„Ø§Ø­ØªÙŠØ§Ù„ØŒ ÙˆØ¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù…Ù„ (SOPs) Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±
                        Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©.</p>
                </div>

                <div class="service-box" data-service="projects" onclick="toggleService(this)">
                    <span class="tag">Ù…Ø´Ø§Ø±ÙŠØ¹</span>
                    <div class="icon">ğŸ“Š</div>
                    <h3>Ø¯Ø¹Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h3>
                    <p>ØªØ­Ø³ÙŠÙ† Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ØŒ Ø®Ø·Ø· ØªÙ†ÙÙŠØ°ØŒ Ù…ØµÙÙˆÙØ§Øª Ù…Ù†Ø·Ù‚ÙŠØ©ØŒ ÙˆØ®Ø·Ø· Ø¹Ù…Ù„ Ø²Ù…Ù†ÙŠØ© Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ù†Ø¸Ù…Ø©.</p>
                </div>

                <div class="service-box" data-service="meal" onclick="toggleService(this)">
                    <span class="tag">MEAL</span>
                    <div class="icon">ğŸ“ˆ</div>
                    <h3>Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù…Ø³Ø§Ø¡Ù„Ø©</h3>
                    <p>Ø¥Ø·Ø§Ø± MEAL Ù…Ù†Ø§Ø³Ø¨ØŒ Ù…Ø¤Ø´Ø±Ø§Øª Ø£Ø¯Ø§Ø¡ SMARTØŒ Ø£Ø¯ÙˆØ§Øª Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙˆØ¢Ù„ÙŠØ§Øª Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡Ù„Ø©.</p>
                </div>

                <div class="service-box" data-service="hr" onclick="toggleService(this)">
                    <span class="tag">Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©</span>
                    <div class="icon">ğŸ‘¥</div>
                    <h3>ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</h3>
                    <p>ØªØ­Ù„ÙŠÙ„ ÙØ¬ÙˆØ§Øª Ø§Ù„Ù…Ù‡Ø§Ø±Ø§ØªØŒ Ø®Ø·Ø· ØªØ¯Ø±ÙŠØ¨ Ù…Ø®ØµØµØ©ØŒ Ù…Ø³Ø§Ø±Ø§Øª Ù…Ù‡Ù†ÙŠØ©ØŒ ÙˆØªØ­Ø³ÙŠÙ† Ø¢Ù„ÙŠØ§Øª Ø§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡.</p>
                </div>

                <div class="service-box" data-service="proposals" onclick="toggleService(this)">
                    <span class="tag">ØªÙ…ÙˆÙŠÙ„</span>
                    <div class="icon">ğŸ’°</div>
                    <h3>ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©</h3>
                    <p>ØªØ­Ù„ÙŠÙ„ Ù‚Ø¯Ø±Ø© Ø¬Ø°Ø¨ Ø§Ù„ØªÙ…ÙˆÙŠÙ„ØŒ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„Ù…Ø§Ù†Ø­ÙŠÙ†ØŒ Ù‚ÙˆØ§Ù„Ø¨ Ù…Ù‚ØªØ±Ø­Ø§Øª ÙˆÙ…ÙŠØ²Ø§Ù†ÙŠØ§Øª Ù…ØªÙˆØ§ÙÙ‚Ø©.</p>
                </div>

                <div class="service-box" data-service="governance" onclick="toggleService(this)">
                    <span class="tag">Ø­ÙˆÙƒÙ…Ø©</span>
                    <div class="icon">âš–ï¸</div>
                    <h3>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©</h3>
                    <p>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ÙŠØ© ÙˆØ§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©ØŒ Ø­Ù„ÙˆÙ„ Ø§Ù„ØªØ®ÙÙŠÙØŒ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´ÙØ§ÙÙŠØ© ÙˆØ¯Ø¹Ù… Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø±.</p>
                </div>
            </div>
        </section>

        <!-- Action Button -->
        <div class="action-section">
            <button class="btn-analyze" id="analyzeBtn" onclick="startAnalysis()">
                <i class="fas fa-rocket"></i> Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª
            </button>
            <p style="margin-top: 15px; color: #64748b; font-size: 0.9rem;">
                Ø³ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø¸Ù…ØªÙƒ ÙˆØªÙˆÙ„ÙŠØ¯ ØªÙˆØµÙŠØ§Øª Ù…Ø®ØµØµØ© 100% Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ø§Ù„ÙØ¹Ù„ÙŠØ©
            </p>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <h2 style="text-align: center; margin-bottom: 40px; color: var(--org-primary);">
                <i class="fas fa-chart-bar"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª
            </h2>
            <div id="resultsContainer"></div>

            <div class="export-actions">
                <button class="btn-export primary" onclick="ProtectionManager.verify(() => window.print())">
                    <i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF
                </button>
                <button class="btn-export secondary" onclick="copyResults()">
                    <i class="fas fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                </button>
                <button class="btn-export secondary" onclick="startNewAnalysis()">
                    <i class="fas fa-redo"></i> ØªØ­Ù„ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø©...</div>
        <div class="loading-subtext" id="loadingSubtext">ÙŠØªÙ… Ø§Ù„Ø¢Ù† Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø®ØµØµØ©</div>
    </div>

    <script>
        // State Management
        let selectedServices = [];
        let uploadedFiles = [];
        let analysisResults = {};

        // File Upload Handling
        const fileDropZone = document.getElementById('fileDropZone');
        const fileInput = document.getElementById('fileInput');
        const uploadedFilesList = document.getElementById('uploadedFilesList');

        fileDropZone.addEventListener('click', () => fileInput.click());

        fileDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileDropZone.classList.add('dragover');
        });

        fileDropZone.addEventListener('dragleave', () => {
            fileDropZone.classList.remove('dragover');
        });

        fileDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            fileDropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        async function handleFiles(files) {
            for (let file of files) {
                if (file.size > 10 * 1024 * 1024) {
                    alert(`Ø§Ù„Ù…Ù„Ù "${file.name}" ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ (10MB)`);
                    continue;
                }

                const allowedTypes = ['.pdf', '.docx', '.doc', '.txt'];
                const ext = '.' + file.name.split('.').pop().toLowerCase();
                if (!allowedTypes.includes(ext)) {
                    alert(`Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù "${file.name}" ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…`);
                    continue;
                }

                // Read file content
                const content = await readFileContent(file);
                uploadedFiles.push({
                    name: file.name,
                    type: ext,
                    content: content
                });

                renderUploadedFiles();
            }
        }

        async function readFileContent(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    if (file.name.endsWith('.txt')) {
                        resolve(e.target.result);
                    } else {
                        // For PDF/DOCX, store base64 for now (can be processed server-side)
                        resolve(`[Ù…Ù„Ù: ${file.name}]`);
                    }
                };
                if (file.name.endsWith('.txt')) {
                    reader.readAsText(file);
                } else {
                    reader.readAsDataURL(file);
                }
            });
        }

        function renderUploadedFiles() {
            uploadedFilesList.innerHTML = uploadedFiles.map((f, i) => `
                <div class="uploaded-file">
                    <i class="fas fa-file"></i>
                    <span>${f.name}</span>
                    <button class="remove-file" onclick="removeFile(${i})"><i class="fas fa-times"></i></button>
                </div>
            `).join('');
        }

        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            renderUploadedFiles();
        }

        // Service Selection
        function toggleService(element) {
            element.classList.toggle('active');
            const service = element.dataset.service;

            if (element.classList.contains('active')) {
                if (!selectedServices.includes(service)) {
                    selectedServices.push(service);
                }
            } else {
                selectedServices = selectedServices.filter(s => s !== service);
            }
        }

        // Main Analysis Function
        async function startAnalysis() {
            // Validate inputs
            const orgData = {
                name: document.getElementById('orgName').value,
                type: document.getElementById('orgType').value,
                size: document.getElementById('orgSize').value,
                country: document.getElementById('orgCountry').value,
                phase: document.getElementById('orgPhase').value,
                sectors: document.getElementById('orgSectors').value,
                challenges: document.getElementById('orgChallenges').value
            };

            if (!orgData.type) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©');
                return;
            }

            if (selectedServices.length === 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø®Ø¯Ù…Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            // Show loading
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingSubtext = document.getElementById('loadingSubtext');
            const analyzeBtn = document.getElementById('analyzeBtn');

            loadingOverlay.classList.add('active');
            analyzeBtn.disabled = true;

            const loadingMessages = [
                'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø©...',
                'ÙŠØªÙ… Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ Ø§Ù„Ù…Ù‚ØªØ±Ø­...',
                'Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª...',
                'ÙŠØªÙ… ØªØ­Ù„ÙŠÙ„ ÙØ¬ÙˆØ§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡...',
                'Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø®ØµØµØ©...'
            ];

            let msgIndex = 0;
            const msgInterval = setInterval(() => {
                msgIndex = (msgIndex + 1) % loadingMessages.length;
                loadingSubtext.textContent = loadingMessages[msgIndex];
            }, 3000);

            try {
                // Build the comprehensive prompt
                const prompt = buildOrgServicesPrompt(orgData, selectedServices, uploadedFiles);

                // Call AI
                const result = await apiProxy.callAI(prompt, {
                    model: "llama-3.3-70b-versatile",
                    temperature: 0.4
                });

                // Process and display results
                if (result) {
                    analysisResults = parseOrgResults(result, selectedServices);
                    displayResults(analysisResults);
                } else {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ù†ØªØ§Ø¦Ø¬ Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù…');
                }
            } catch (error) {
                console.error('Analysis Error:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            } finally {
                clearInterval(msgInterval);
                loadingOverlay.classList.remove('active');
                analyzeBtn.disabled = false;
            }
        }

        function buildOrgServicesPrompt(orgData, services, files) {
            const serviceLabels = {
                structure: 'ØªØ·ÙˆÙŠØ± Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„ÙØ±Ù‚',
                policies: 'ØªØ·ÙˆÙŠØ± Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª (Policies & SOPs)',
                projects: 'Ø¯Ø¹Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆØ§Ù„Ø¨Ø±Ø§Ù…Ø¬',
                meal: 'Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… ÙˆØ§Ù„Ù…Ø³Ø§Ø¡Ù„Ø© (MEAL)',
                hr: 'ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª',
                proposals: 'ÙƒØªØ§Ø¨Ø© ÙˆØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©',
                governance: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø­ÙˆÙƒÙ…Ø©'
            };

            const orgTypeLabels = {
                humanitarian: 'Ø¥Ù†Ø³Ø§Ù†ÙŠØ©',
                development: 'ØªÙ†Ù…ÙˆÙŠØ©',
                rights: 'Ø­Ù‚ÙˆÙ‚ÙŠØ©',
                education: 'ØªØ¹Ù„ÙŠÙ…ÙŠØ©',
                health: 'ØµØ­ÙŠØ©',
                local: 'Ù…Ø­Ù„ÙŠØ©',
                international: 'Ø¯ÙˆÙ„ÙŠØ©'
            };

            const orgSizeLabels = {
                startup: 'Ù†Ø§Ø´Ø¦Ø©',
                small: 'ØµØºÙŠØ±Ø©',
                medium: 'Ù…ØªÙˆØ³Ø·Ø©',
                large: 'ÙƒØ¨ÙŠØ±Ø©'
            };

            const orgPhaseLabels = {
                founding: 'ØªØ£Ø³ÙŠØ³',
                growth: 'ØªÙˆØ³Ø¹ ÙˆÙ†Ù…Ùˆ',
                restructure: 'Ø¥Ø¹Ø§Ø¯Ø© Ù‡ÙŠÙƒÙ„Ø©',
                mature: 'Ù†Ø¶Ø¬ ÙˆØ§Ø³ØªØ¯Ø§Ù…Ø©'
            };

            const requestedServices = services.map(s => serviceLabels[s]).join('\n- ');
            const filesContent = files.length > 0 ? files.map(f => f.content).join('\n\n') : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª Ù…Ø±ÙÙˆØ¹Ø©';

            return `
Ø£Ù†Øª Ù…Ø³ØªØ´Ø§Ø± Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠ Ø£ÙˆÙ„ Ù„Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ© ÙˆØ§Ù„ØªÙ†Ù…ÙˆÙŠØ© ÙˆØºÙŠØ± Ø§Ù„Ø±Ø¨Ø­ÙŠØ©ØŒ ØªØ¹Ù…Ù„ Ø¶Ù…Ù† Ù…Ù†ØµØ© "Ø£Ø«Ø±"ØŒ ÙˆÙ…ØªØ®ØµØµ ÙÙŠ:
- Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©
- ØªØ·ÙˆÙŠØ± Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
- Ø§Ù„Ø­ÙˆÙƒÙ…Ø©ØŒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…ØŒ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©ØŒ ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ÙØ¯Ø®Ù„Ø©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø©: ${orgData.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
- Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†Ø¸Ù…Ø©: ${orgTypeLabels[orgData.type] || orgData.type}
- Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø©: ${orgSizeLabels[orgData.size] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
- Ø§Ù„Ø¯ÙˆÙ„Ø© / Ø§Ù„Ø³ÙŠØ§Ù‚: ${orgData.country || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
- Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©: ${orgPhaseLabels[orgData.phase] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
- Ø§Ù„Ù‚Ø·Ø§Ø¹Ø§Øª / Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬: ${orgData.sectors || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
- Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ù„Ù†Ø©: ${orgData.challenges || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
${filesContent}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
- ${requestedServices}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš ï¸ Ù‚ÙˆØ§Ø¹Ø¯ Ø¥Ù„Ø²Ø§Ù…ÙŠØ© Ù„Ù„Ù…Ø®Ø±Ø¬Ø§Øª
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
1. ÙƒÙ„ Ø®Ø¯Ù…Ø© ØªÙƒÙˆÙ† Ù…Ø®ØµØµØ© 100% Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ¯
2. Ø¹Ù…Ù„ÙŠØ© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙˆØ±ÙŠ
3. Ù…ÙƒØªÙˆØ¨Ø© Ø¨Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© ØºÙŠØ± ØªØ³ÙˆÙŠÙ‚ÙŠØ©
4. ÙŠÙÙ…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø£Ùˆ Ø§Ù„Ù†Ø³Ø® Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
5. ÙŠÙÙ…Ù†Ø¹ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ø¯ÙˆÙ† Ø´Ø±Ø­ ØªÙØµÙŠÙ„ÙŠ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¤ ØµÙŠØºØ© Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª (JSON)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ø£Ø±Ø¬Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø­ØµØ±ÙŠØ§Ù‹ Ø¨ØµÙŠØºØ© JSON ÙƒØ§Ù„ØªØ§Ù„ÙŠ:
{
    "organization_analysis": {
        "summary": "Ù…Ù„Ø®Øµ ØªÙ†ÙÙŠØ°ÙŠ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ",
        "strengths": ["Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©"],
        "weaknesses": ["Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù"],
        "opportunities": ["Ø§Ù„ÙØ±Øµ"],
        "threats": ["Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª"]
    },
    "services": {
        "structure": {
            "title": "ØªØ·ÙˆÙŠØ± Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„ØªÙ†Ø¸ÙŠÙ…ÙŠ",
            "current_analysis": "ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ",
            "recommendations": ["Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©"],
            "proposed_structure": "Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­",
            "job_descriptions": ["ØªÙˆØµÙŠÙ ÙˆØ¸ÙŠÙÙŠ Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ù†Ø§ØµØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"],
            "gaps": ["ÙØ¬ÙˆØ§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ"]
        },
        "policies": {
            "title": "Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª ÙˆØ§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª",
            "required_policies": ["Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø­Ø³Ø¨ Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø¸Ù…Ø©"],
            "priority_sops": ["Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø°Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©"],
            "compliance_notes": "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±"
        },
        "projects": {
            "title": "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹",
            "capacity_assessment": "ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù‚Ø¯Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©",
            "pcm_recommendations": ["ØªÙˆØµÙŠØ§Øª ØªØ­Ø³ÙŠÙ† Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹"],
            "tools": ["Ø£Ø¯ÙˆØ§Øª Ù…Ù‚ØªØ±Ø­Ø©"]
        },
        "meal": {
            "title": "Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…",
            "framework": "Ø¥Ø·Ø§Ø± MEAL Ø§Ù„Ù…Ù‚ØªØ±Ø­",
            "indicators": ["Ù…Ø¤Ø´Ø±Ø§Øª SMART Ù…Ù‚ØªØ±Ø­Ø©"],
            "tools": ["Ø£Ø¯ÙˆØ§Øª Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"],
            "accountability": "Ø¢Ù„ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¡Ù„Ø©"
        },
        "hr": {
            "title": "Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©",
            "skills_gaps": ["ÙØ¬ÙˆØ§Øª Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª"],
            "training_plan": ["Ø®Ø·Ø© ØªØ¯Ø±ÙŠØ¨ Ù…Ù‚ØªØ±Ø­Ø©"],
            "career_paths": "Ù…Ø³Ø§Ø±Ø§Øª Ù…Ù‡Ù†ÙŠØ© Ù…Ù‚ØªØ±Ø­Ø©"
        },
        "proposals": {
            "title": "Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠØ©",
            "funding_readiness": "ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„ØªÙ…ÙˆÙŠÙ„",
            "recommendations": ["ØªÙˆØµÙŠØ§Øª ØªØ­Ø³ÙŠÙ†"],
            "templates": "Ù‚ÙˆØ§Ù„Ø¨ Ù…Ù‚ØªØ±Ø­Ø©"
        },
        "governance": {
            "title": "Ø§Ù„Ø­ÙˆÙƒÙ…Ø© ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±",
            "risks": ["Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©"],
            "mitigation": ["Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ®ÙÙŠÙ"],
            "governance_recommendations": ["ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø­ÙˆÙƒÙ…Ø©"]
        }
    },
    "action_plan": {
        "immediate": ["Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙÙˆØ±ÙŠØ© (0-30 ÙŠÙˆÙ…)"],
        "short_term": ["Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰ (1-3 Ø£Ø´Ù‡Ø±)"],
        "long_term": ["Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰ (3-12 Ø´Ù‡Ø±)"]
    }
}

Ù‚Ù… Ø§Ù„Ø¢Ù† Ø¨ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© ÙˆØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙÙ‚Ø·. Ø£Ø±Ø¬Ø¹ JSON ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù†Øµ Ø¥Ø¶Ø§ÙÙŠ.
            `.trim();
        }

        function parseOrgResults(result, services) {
            let data = {};

            try {
                // Extract JSON from response
                let jsonStr = result;
                if (typeof result === 'object') {
                    jsonStr = JSON.stringify(result);
                }

                // Try to find JSON in the response
                const jsonMatch = jsonStr.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    data = JSON.parse(jsonMatch[0]);
                }
            } catch (e) {
                console.error('Parse error:', e);
                // Create a basic structure if parsing fails
                data = {
                    organization_analysis: {
                        summary: typeof result === 'string' ? result : 'ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¸Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­',
                        strengths: [],
                        weaknesses: [],
                        opportunities: [],
                        threats: []
                    },
                    services: {},
                    action_plan: {
                        immediate: [],
                        short_term: [],
                        long_term: []
                    }
                };
            }

            return data;
        }

        function displayResults(data) {
            const container = document.getElementById('resultsContainer');
            let html = '';

            // Organization Analysis
            if (data.organization_analysis) {
                const analysis = data.organization_analysis;
                html += `
                    <div class="result-card">
                        <h3><i class="fas fa-building"></i> Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ</h3>
                        <div class="result-content">
                            <p><strong>Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ:</strong></p>
                            <p>${analysis.summary || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                                <div style="background: #f0fdf4; padding: 15px; border-radius: 10px; border-right: 4px solid #10b981;">
                                    <strong style="color: #10b981;">âœ… Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©</strong>
                                    <ul>${(analysis.strengths || []).map(s => `<li>${s}</li>`).join('') || '<li>ØºÙŠØ± Ù…Ø­Ø¯Ø¯</li>'}</ul>
                                </div>
                                <div style="background: #fef2f2; padding: 15px; border-radius: 10px; border-right: 4px solid #ef4444;">
                                    <strong style="color: #ef4444;">âš ï¸ Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù</strong>
                                    <ul>${(analysis.weaknesses || []).map(w => `<li>${w}</li>`).join('') || '<li>ØºÙŠØ± Ù…Ø­Ø¯Ø¯</li>'}</ul>
                                </div>
                                <div style="background: #eff6ff; padding: 15px; border-radius: 10px; border-right: 4px solid #3b82f6;">
                                    <strong style="color: #3b82f6;">ğŸš€ Ø§Ù„ÙØ±Øµ</strong>
                                    <ul>${(analysis.opportunities || []).map(o => `<li>${o}</li>`).join('') || '<li>ØºÙŠØ± Ù…Ø­Ø¯Ø¯</li>'}</ul>
                                </div>
                                <div style="background: #fefce8; padding: 15px; border-radius: 10px; border-right: 4px solid #f59e0b;">
                                    <strong style="color: #f59e0b;">ğŸ”¥ Ø§Ù„ØªÙ‡Ø¯ÙŠØ¯Ø§Øª</strong>
                                    <ul>${(analysis.threats || []).map(t => `<li>${t}</li>`).join('') || '<li>ØºÙŠØ± Ù…Ø­Ø¯Ø¯</li>'}</ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Services Results
            if (data.services) {
                const serviceIcons = {
                    structure: 'ğŸ—ï¸',
                    policies: 'ğŸ“‹',
                    projects: 'ğŸ“Š',
                    meal: 'ğŸ“ˆ',
                    hr: 'ğŸ‘¥',
                    proposals: 'ğŸ’°',
                    governance: 'âš–ï¸'
                };

                for (const [key, service] of Object.entries(data.services)) {
                    if (service && selectedServices.includes(key)) {
                        html += `
                            <div class="result-card">
                                <h3>${serviceIcons[key] || 'ğŸ“Œ'} ${service.title || key}</h3>
                                <div class="result-content">
                                    ${renderServiceContent(key, service)}
                                </div>
                            </div>
                        `;
                    }
                }
            }

            // Action Plan
            if (data.action_plan) {
                const plan = data.action_plan;
                html += `
                    <div class="result-card">
                        <h3><i class="fas fa-tasks"></i> Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</h3>
                        <div class="result-content">
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                                <div style="background: #fef3c7; padding: 20px; border-radius: 10px;">
                                    <strong style="color: #d97706;">ğŸ”¥ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª ÙÙˆØ±ÙŠØ© (0-30 ÙŠÙˆÙ…)</strong>
                                    <ul>${(plan.immediate || []).map(i => `<li>${i}</li>`).join('') || '<li>ØºÙŠØ± Ù…Ø­Ø¯Ø¯</li>'}</ul>
                                </div>
                                <div style="background: #dbeafe; padding: 20px; border-radius: 10px;">
                                    <strong style="color: #2563eb;">ğŸ“… Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰ (1-3 Ø£Ø´Ù‡Ø±)</strong>
                                    <ul>${(plan.short_term || []).map(s => `<li>${s}</li>`).join('') || '<li>ØºÙŠØ± Ù…Ø­Ø¯Ø¯</li>'}</ul>
                                </div>
                                <div style="background: #dcfce7; padding: 20px; border-radius: 10px;">
                                    <strong style="color: #16a34a;">ğŸ¯ Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰ (3-12 Ø´Ù‡Ø±)</strong>
                                    <ul>${(plan.long_term || []).map(l => `<li>${l}</li>`).join('') || '<li>ØºÙŠØ± Ù…Ø­Ø¯Ø¯</li>'}</ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
            document.getElementById('resultsSection').style.display = 'block';

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        function renderServiceContent(key, service) {
            let content = '';

            for (const [field, value] of Object.entries(service)) {
                if (field === 'title') continue;

                const fieldLabel = getFieldLabel(field);

                if (Array.isArray(value)) {
                    content += `
                        <div style="margin-bottom: 20px;">
                            <strong>${fieldLabel}:</strong>
                            <ul>${value.map(v => `<li>${v}</li>`).join('')}</ul>
                        </div>
                    `;
                } else if (typeof value === 'string' && value) {
                    content += `
                        <div style="margin-bottom: 20px;">
                            <strong>${fieldLabel}:</strong>
                            <p>${value}</p>
                        </div>
                    `;
                }
            }

            return content || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø©</p>';
        }

        function getFieldLabel(field) {
            const labels = {
                current_analysis: 'ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ',
                recommendations: 'Ø§Ù„ØªÙˆØµÙŠØ§Øª',
                proposed_structure: 'Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­',
                job_descriptions: 'Ø§Ù„ØªÙˆØµÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ',
                gaps: 'ÙØ¬ÙˆØ§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ',
                required_policies: 'Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©',
                priority_sops: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø°Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©',
                compliance_notes: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙˆØ§ÙÙ‚',
                capacity_assessment: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù‚Ø¯Ø±Ø©',
                pcm_recommendations: 'ØªÙˆØµÙŠØ§Øª Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹',
                tools: 'Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©',
                framework: 'Ø§Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­',
                indicators: 'Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª',
                accountability: 'Ø¢Ù„ÙŠØ© Ø§Ù„Ù…Ø³Ø§Ø¡Ù„Ø©',
                skills_gaps: 'ÙØ¬ÙˆØ§Øª Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª',
                training_plan: 'Ø®Ø·Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨',
                career_paths: 'Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©',
                funding_readiness: 'Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ù„Ù„ØªÙ…ÙˆÙŠÙ„',
                templates: 'Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©',
                risks: 'Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
                mitigation: 'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø§Ù„ØªØ®ÙÙŠÙ',
                governance_recommendations: 'ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø­ÙˆÙƒÙ…Ø©'
            };
            return labels[field] || field;
        }

        function copyResults() {
            const resultsText = document.getElementById('resultsContainer').innerText;
            navigator.clipboard.writeText(resultsText).then(() => {
                alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ù†Ø¬Ø§Ø­!');
            }).catch(() => {
                alert('ÙØ´Ù„ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ù†ØªØ§Ø¦Ø¬');
            });
        }

        function startNewAnalysis() {
            // Reset form
            document.getElementById('orgName').value = '';
            document.getElementById('orgType').value = '';
            document.getElementById('orgSize').value = '';
            document.getElementById('orgCountry').value = '';
            document.getElementById('orgPhase').value = '';
            document.getElementById('orgSectors').value = '';
            document.getElementById('orgChallenges').value = '';

            // Reset services
            selectedServices = [];
            document.querySelectorAll('.service-box').forEach(box => box.classList.remove('active'));

            // Reset files
            uploadedFiles = [];
            renderUploadedFiles();

            // Hide results
            document.getElementById('resultsSection').style.display = 'none';

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
    <div class="signature-athar" style="margin-top: 50px; background: rgba(15, 23, 42, 0.05); padding: 40px 20px;">
        Ø§Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ° <span class="designer-name">Ø£: Ù†Ø¨ÙŠÙ„ Ø§Ù„Ø­Ù…ÙŠØ¯</span>
    </div>
</body>

</html>